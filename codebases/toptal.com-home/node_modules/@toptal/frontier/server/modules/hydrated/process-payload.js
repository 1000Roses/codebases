/**
 * Safely serializes the passed payload by replacing
 * '</script' to '<\/script' to not break HTML script parsing.
 *
 * WARNING!
 * Only plain object props are accepted.
 * You cannot pass functions as props, inclduing other
 * components for partially hydrated components.
 *
 * Performance considerations.
 * With a ~150kb of HTML added to payload, serialization
 * takes less than 5ms on a MacBook Pro 2013 with a non-heavy
 * CPU load. Deserialization in Chrome with 6x CPU throttling
 * is within a 25ms upper bound.
 *
 * @param {object} payload
 */
function serialize(payload) {
    return JSON.stringify(payload).replace(/<\/script/gim, '<\\/script')
}

/**
 * Deserializes props from HTML with respect to the safe
 * '<\/script' serialization.
 *
 * @param {string} json
 */
function deserialize(json) {
    return JSON.parse(json.replace(/<\\\/script/gim, '</script'))
}

export {
    serialize,
    deserialize
}